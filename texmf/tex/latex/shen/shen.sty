%% shen.sty %% Copyright 2019 Eric Shen %
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Eric Shen.
%
% This work consists of the file shen.sty.
\ProvidesPackage{shen}

% ======== Arguments and Options ========
\newif\iftheorembychapter\theorembychapterfalse
\newif\iftheorembysection\theorembysectionfalse
\newif\ifcodeused\codeusedfalse
\newif\iffancyused\fancyusedtrue
\newif\ifmathpazofontused\mathpazofontusedfalse
\newif\ifmarginset\marginsettrue
\newif\ifcolorthmon\colorthmontrue
\newif\ifthmenabled\thmenabledtrue
\newif\ifindenting\indentingtrue
\newif\ifendproofnow\endproofnowfalse
\newif\ifcolorsecstyle\colorsecstyletrue
\newif\ifplainsol\plainsolfalse
\newif\iffillqedsymbol\fillqedsymbolfalse
\newif\ifvonenabled\vonenabledfalse
\newif\ifasyenabled\asyenabledtrue
\newif\ifrollingboxprob\rollingboxprobfalse

% ======== OPTIONS ========
% Loads preferred options
\DeclareOption{default}{
    \fancyusedtrue
    \mathpazofontusedtrue
}

% Number theorems by chapter, section, or nothing
\DeclareOption{chthm}{\theorembychaptertrue}
\DeclareOption{secthm}{\theorembysectiontrue}
\DeclareOption{noparthm}{\theorembysectionfalse}

% Allow lstlisting
\DeclareOption{code}{\codeusedtrue}

% Fancy formatting
\DeclareOption{fancy}{\fancyusedtrue}
\DeclareOption{nofancy}{\fancyusedfalse}

% Font selection (palatino, roman)
\DeclareOption{font}{\mathpazofontusedtrue}
\DeclareOption{nofont}{\mathpazofontusedfalse}

% Do not set margin
\DeclareOption{nomargin}{\marginsetfalse}

% No asymptote
\DeclareOption{noasy}{\asyenabledfalse}

% Create plain document w/o fancy formatting
\DeclareOption{plain}{
    \colorthmonfalse
    \colorsecstylefalse
    \plainsoltrue
}

% Colorful theorems and section titles
\DeclareOption{colorthm}{\colorthmontrue}
\DeclareOption{colorsec}{\colorsecstyletrue}

% Plain formatting modules
\DeclareOption{plainthm}{\colorthmonfalse}
\DeclareOption{plainsec}{\colorsecstylefalse}
\DeclareOption{plainsol}{\plainsoltrue}

% Do not create theorems
\DeclareOption{nothm}{\thmenabledfalse}
\DeclareOption{indent}{\indentingtrue}

% DEPRECATED -- do not indent
\DeclareOption{noindent}{\indentingfalse}

% Where to place qedsymbol (right, now)
\DeclareOption{rightqed}{\endproofnowfalse}
\DeclareOption{nowqed}{\endproofnowtrue}

% Fill qed symbol?
\DeclareOption{fillqed}{\fillqedsymboltrue}

% Rolling boxprob?
\DeclareOption{rollprob}{\rollingboxprobtrue}

% Evan's ``von'' problem manager
\DeclareOption{von}{\vonenabledtrue}
\ProcessOptions\relax

% ======== DEFAULT IMPORTS ========
\ifmarginset
    \usepackage[margin=1in,bottom=0.75in]{geometry}
\fi
\usepackage{amsmath,amsfonts,amssymb}
\PassOptionsToPackage{usenames,svgnames,dvipsnames}{xcolor}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{mathdots} % Fancy dots
\usepackage[final]{pdfpages} % Inserting PDF's
\usepackage{siunitx} % SI Units
\usepackage{mdframed} % MDFramed
\usepackage{enumitem} % enum customization
\usepackage{version} % Hiding specific text
\usepackage{mathtools} % Math tools
\usepackage[T1]{fontenc} % Make serif look ok
\usepackage{epigraph} % Quotes!
\usepackage{hyperref} % Referrences

% ======== BASIC FORMATTING ========
% Colorful text
\definecolor{astral}{RGB}{46,116,181}
\definecolor{royalblue}{RGB}{0,35,102}
\definecolor{turtle}{RGB}{0,64,64}

% Useful commands
\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
\newcommand{\da}[0]{\measuredangle}
\newcommand{\ans}[5]{\textbf{(A) }#1\qquad\textbf{(B) }#2\qquad\textbf{(C) }#3\qquad\textbf{(D) }#4\qquad\textbf{(E) }#5}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceiling}[1]{\left\lceil #1 \right\rceil}
\newcommand{\vphi}{\varphi}
\newcommand{\cycsum}{\sum_\mathrm{cyc}}
\newcommand{\symsum}{\sum_\mathrm{sym}}
\newcommand{\cycprod}{\prod_\mathrm{cyc}}
\newcommand{\symprod}{\prod_\mathrm{sym}}
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\ray}[1]{\overrightarrow{#1}} 
\newcommand{\seg}[1]{\overline{#1}}
\newcommand{\arc}[1]{\widehat{#1}}
\newcommand{\defeq}{\overset{\mathrm{def}}{=}}
\newcommand{\dg}{^\circ}
\newcommand{\ii}{\item}
\newcommand{\liff}{\leftrightarrow}
\newcommand{\lthen}{\rightarrow}
\newcommand{\opname}{\operatorname}
\newcommand{\surjto}{\twoheadrightarrow}
\newcommand{\injto}{\hookrightarrow}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\ta}{\triangle}
\ifcolorsecstyle
    \newcommand{\vocab}[1]{\textbf{\color{astral}#1}}
\else
    \newcommand{\vocab}[1]{\textbf{#1}}
\fi
\newcommand{\sh}{\texttt{\color{MidnightBlue}\$\hspace{8pt}}}
\newcommand{\shh}{\texttt{\color{MidnightBlue}\$\hspace{3pt}}}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\cis}{cis}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\pow}{Pow}
\DeclareMathOperator{\rad}{rad}

% varying sizes in \pmod
\makeatletter
\DeclarePairedDelimiterX{\pmodx}[1]{(}{)}{{\operator@font mod}\mkern6mu#1}
\renewcommand{\pmod}{
    \allowbreak
    \if@display\mkern18mu\else\mkern8mu\fi
    \pmodx
}
\makeatother

% Fancy setup
\iffancyused
    \usepackage{fancyhdr}
    \pagestyle{fancy}
    \fancyhf{}
    \iftheorembychapter
        \fancyhead[LO]{Ch. \thechapter: \nouppercase{\leftmark}}
        \fancyhead[RE]{Ch. \thechapter: \nouppercase{\leftmark}}
    \fi
    \chead{}
    %\fancyhead[LE]{\thepage}
    %\fancyhead[RO]{\thepage}
    \makeatletter
    \lhead{\@title}
    \makeatother
    \rhead{\theauthor}
    \lfoot{}
    \cfoot{\thepage}
    \rfoot{}
    \renewcommand{\headrulewidth}{0.4pt}

    \ifmarginset
        \setlength{\headsep}{10pt}
        \setlength{\oddsidemargin}{0in}
        \setlength{\evensidemargin}{0in}
    \fi
\fi

\iftheorembychapter
    \renewcommand{\chaptermark}[1]{%
    \markboth{#1}{}}
\fi

% colorsec style setup
\ifcolorsecstyle
    \usepackage{titlesec}
    \usepackage{titling}
    \hypersetup{
        colorlinks,
        citecolor=astral,
        filecolor=astral,
        linkcolor=astral,
        urlcolor=astral
    }

    \newcommand{\announcefont}{\bfseries
    \fontfamily{lmss}\selectfont\color{royalblue}}
    \newcommand{\boldseriffont}{\bfseries
    \fontfamily{lmss}\selectfont}		
    \newcommand{\seriffont}{\fontfamily{lmss}\selectfont}

    \titleformat{\section}{\announcefont\Large}
    {{\sffamily\S}\thesection}{1em}{}
    \titleformat{\subsection}{\announcefont\large}
    {{\sffamily\S}\thesubsection}{1em}{}
    \titleformat{\subsubsection}{\announcefont\normalsize}
    {{\sffamily\S}\thesubsubsection}{1em}{}

%	\makeatletter
%	\def\@seccntformat#1{\numerofont\textbf\S\csname the#1\endcsname\quad}
%	\makeatother

    \pretitle{\begin{center}\LARGE\boldseriffont}
    \posttitle{\par\end{center}\vskip 0.5em}
    \preauthor{\begin{center}
            \large \lineskip 0.5em%
            \begin{tabular}[t]{c}
            \seriffont}
    \postauthor{\end{tabular}\par\end{center}}
    \predate{\begin{center}\large\seriffont}
    \postdate{\par\end{center}}

    
%    \usepackage[tocindentauto]{tocstyle}
%    \newcommand{\autodot}{\sffamily}
\fi

% Absolutely no page break
\newenvironment{absolutelynopagebreak}
{\par\nobreak\vfil\penalty0\vfilneg
\vtop\bgroup}
{\par\xdef\tpd{\the\prevdepth}\egroup
\prevdepth=\tpd}

% ======== PAGE SETUP ========
\ifindenting
    \renewcommand{\baselinestretch}{1.05}
    %\setlength{\parskip}{1pt}
\else
    \setlength{\parindent}{0.5pt}
    \setlength{\parskip}{\baselineskip}
\fi

% Font
\ifmathpazofontused
    \usepackage{mathpazo}
\fi

% ======== THEOREMS! <3 ========
\ifthmenabled 
    \usepackage{amsthm,thmtools}
% Theorem Styles --- Based on Evan's pretty boxes
    \ifcolorthmon
        \ifindenting % Linebreaking for indention
            \mdfdefinestyle{mdbluebox}{%
                roundcorner = 10pt,
                linewidth=0pt, %1pt,
                skipabove=12pt,
                innerbottommargin=9pt,
                skipbelow=2pt,
                linecolor=blue,
%                nobreak=true,
                backgroundcolor=TealBlue!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{MidnightBlue},
                mdframed={style=mdbluebox},
                headpunct={\\[3pt]},
                postheadspace={0pt}
            ]{thmbluebox}
            \declaretheoremstyle[
                headfont=\ttfamily\color{MidnightBlue},
                bodyfont=\ttfamily,
                mdframed={style=mdbluebox},
                headpunct={},
                postheadspace={8pt}
            ]{thminlinebluebox}

            \mdfdefinestyle{mdpurplebox}{%
                roundcorner = 10pt,
                linewidth=0pt, %1pt,
                skipabove=12pt,
                innerbottommargin=9pt,
                skipbelow=2pt,
                linecolor=blue,
%                nobreak=true,
                backgroundcolor=RoyalPurple!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{Violet},
                mdframed={style=mdpurplebox},
                headpunct={\\[3pt]},
                postheadspace={0pt}
            ]{thmpurplebox}

            \mdfdefinestyle{mdredbox}{%
                linewidth=0pt, %0.5pt,
                skipabove=12pt,
                frametitleaboveskip=5pt,
                frametitlebelowskip=0pt,
                skipbelow=2pt,
                frametitlefont=\bfseries,
                innertopmargin=4pt,
                innerbottommargin=8pt,
%                nobreak=true,
                backgroundcolor=Salmon!5,
                linecolor=RawSienna,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{RawSienna},
                mdframed={style=mdredbox},
                headpunct={\\[3pt]},
                postheadspace={0pt},
            ]{thmredbox}

            \mdfdefinestyle{mdorangebox}{%
                linewidth=0pt, %0.5pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                skipabove=12pt,
                frametitleaboveskip=5pt,
                frametitlebelowskip=0pt,
                skipbelow=2pt,
                frametitlefont=\bfseries,
                innertopmargin=4pt,
                innerbottommargin=8pt,
%                nobreak=true,
                backgroundcolor=Peach!5,
                linecolor=BurntOrange,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{BurntOrange},
                mdframed={style=mdorangebox},
                headpunct={\\[3pt]},
                postheadspace={0pt},
            ]{thmorangebox}

            \mdfdefinestyle{mdinlineorangebox}{%
                skipabove=8pt,
                linewidth=3pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                linecolor=black,
                linecolor=BurntOrange,
                backgroundcolor=Peach!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{BurntOrange},
                spaceabove=0pt,
                spacebelow=0pt,
                mdframed={style=mdinlineorangebox},
                headpunct={.\;},
            ]{thminlineorangebox}

            \mdfdefinestyle{mdgreenbox}{%
                skipabove=8pt,
                linewidth=2pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                linecolor=ForestGreen,
                backgroundcolor=ForestGreen!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{ForestGreen!70!black},
                bodyfont=\normalfont,
                spaceabove=2pt,
                spacebelow=1pt,
                mdframed={style=mdgreenbox},
                %headpunct={ --- },
                headpunct={\\[3pt]},
            ]{thmgreenbox}

            \mdfdefinestyle{mdgreenborder}{%
                linewidth=0.5pt,
                skipabove=12pt,
                frametitleaboveskip=5pt,
                frametitlebelowskip=0pt,
                skipbelow=2pt,
                frametitlefont=\bfseries,
                innertopmargin=4pt,
                innerbottommargin=8pt,
%                nobreak=true,
                backgroundcolor=ForestGreen!5,
                linecolor=ForestGreen,
            }
            \declaretheoremstyle[
                headfont=\bfseries\color{ForestGreen},
                mdframed={style=mdgreenborder},
                headpunct={\\[3pt]},
                postheadspace={0pt},
            ]{thmgreenborder}

            \mdfdefinestyle{mdlimebox}{%
                skipabove=8pt,
                linewidth=2pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                linecolor=LimeGreen,
                backgroundcolor=LimeGreen!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{LimeGreen!70!black},
                bodyfont=\normalfont,
                spaceabove=2pt,
                spacebelow=1pt,
                mdframed={style=mdlimebox},
                %headpunct={ --- },
                headpunct={\\[3pt]},
            ]{thmlimebox}

            \mdfdefinestyle{mdlimeborder}{%
                linewidth=0.5pt,
                skipabove=12pt,
                frametitleaboveskip=5pt,
                frametitlebelowskip=0pt,
                skipbelow=2pt,
                frametitlefont=\bfseries,
                innertopmargin=4pt,
                innerbottommargin=8pt,
%                nobreak=true,
                backgroundcolor=LimeGreen!5,
                linecolor=LimeGreen,
            }
            \declaretheoremstyle[
                headfont=\bfseries\color{LimeGreen!70!black},
                mdframed={style=mdlimeborder},
                headpunct={\\[3pt]},
                postheadspace={0pt},
            ]{thmlimeborder}

            \mdfdefinestyle{mdblackbox}{%
                skipabove=8pt,
                linewidth=3pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                linecolor=black,
                backgroundcolor=RedViolet!5!gray!5,
            }
            \declaretheoremstyle[
                headfont=\bfseries,
                bodyfont=\normalfont\small,
                spaceabove=0pt,
                spacebelow=0pt,
                mdframed={style=mdblackbox}
            ]{thmblackbox}

        \else % Linebreaking for no indention
            % THIS SECTION IS DEPRECATED AND NO LONGER MAINTAINED
            % It is only here for backwards compatability.
            \mdfdefinestyle{mdbluebox}{%
                roundcorner = 10pt,
                linewidth=0pt,
                skipabove=12pt,
                innertopmargin=20pt,
                innerbottommargin=9pt,
                skipbelow=2pt,
                linecolor=blue,
%                nobreak=true,
                backgroundcolor=TealBlue!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{MidnightBlue},
                mdframed={style=mdbluebox},
                headpunct={\\[3pt]},
                postheadspace={0pt}
            ]{thmbluebox}

            \mdfdefinestyle{mdredbox}{%
                linewidth=0pt,
                skipabove=12pt,
                frametitleaboveskip=5pt,
                frametitlebelowskip=0pt,
                skipbelow=2pt,
                frametitlefont=\bfseries,
                innertopmargin=20pt,
                innerbottommargin=8pt,
%                nobreak=true,
                backgroundcolor=Salmon!5,
                linecolor=RawSienna,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{RawSienna},
                mdframed={style=mdredbox},
                headpunct={\\[3pt]},
                postheadspace={0pt},
            ]{thmredbox}

            \mdfdefinestyle{mdorangebox}{%
                linewidth=0pt,
                skipabove=12pt,
                frametitleaboveskip=5pt,
                frametitlebelowskip=0pt,
                skipbelow=2pt,
                frametitlefont=\bfseries,
                innertopmargin=20pt,
                innerbottommargin=8pt,
%                nobreak=true,
                backgroundcolor=Peach!5,
                linecolor=BurntOrange,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{BurntOrange},
                mdframed={style=mdorangebox},
                headpunct={\\[3pt]},
                postheadspace={0pt},
            ]{thmorangebox}

            \mdfdefinestyle{mdinlineorangebox}{%
                skipabove=8pt,
                linewidth=3pt,
                rightline=false,
                leftline=false,
                topline=false,
                bottomline=false,
                innertopmargin=18pt,
                linecolor=BurntOrange,
                backgroundcolor=Peach!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{BurntOrange},
                spaceabove=0pt,
                spacebelow=0pt,
                mdframed={style=mdinlineorangebox},
            ]{thminlineorangebox}

            \mdfdefinestyle{mdgreenbox}{%
                skipabove=8pt,
                linewidth=2pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                innertopmargin=18pt,
                linecolor=ForestGreen,
                backgroundcolor=ForestGreen!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{ForestGreen!70!black},
                bodyfont=\normalfont,
                spaceabove=2pt,
                spacebelow=1pt,
                mdframed={style=mdgreenbox},
                %headpunct={ --- },
                headpunct={\\[3pt]}
            ]{thmgreenbox}

            \mdfdefinestyle{mdlimebox}{%
                skipabove=8pt,
                linewidth=2pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                innertopmargin=18pt,
                linecolor=LimeGreen,
                backgroundcolor=LimeGreen!5,
            }
            \declaretheoremstyle[
                headfont=\sffamily\bfseries\color{LimeGreen!70!black},
                bodyfont=\normalfont,
                spaceabove=2pt,
                spacebelow=1pt,
                mdframed={style=mdlimebox},
                %headpunct={ --- },
                headpunct={\\[3pt]}
            ]{thmlimebox}

            \mdfdefinestyle{mdblackbox}{%
                skipabove=8pt,
                linewidth=3pt,
                rightline=false,
                leftline=true,
                topline=false,
                bottomline=false,
                innertopmargin=18pt,
                linecolor=black,
                backgroundcolor=RedViolet!5!gray!5,
            }
            \declaretheoremstyle[
                headfont=\bfseries,
                bodyfont=\normalfont\small,
                spaceabove=0pt,
                spacebelow=0pt,
                mdframed={style=mdblackbox}
            ]{thmblackbox}
        \fi
    \else
        \mdfdefinestyle{mdbox}{%
            linewidth=0.5pt,
            skipabove=12pt,
            frametitleaboveskip=5pt,
            frametitlebelowskip=0pt,
            skipbelow=2pt,
            frametitlefont=\bfseries,
            innertopmargin=4pt,
            innerbottommargin=8pt,
%                nobreak=true,
%            backgroundcolor=ForestGreen!5,
%            linecolor=ForestGreen,
        }
        \declaretheoremstyle[
            headfont=\bfseries,
            bodyfont=\normalfont,
            spaceabove=2pt,
            spacebelow=1pt,
            mdframed={style=mdbox},
        ]{thmbox}
        \declaretheoremstyle[
            headfont=\bfseries\small,
            bodyfont=\normalfont\small,
            spaceabove=2pt,
            spacebelow=1pt,
            mdframed={style=mdbox},
        ]{thmsmallbox}
    \fi

% Theorems definitions
    \ifplainsol
        \newcommand{\wowsol}{}
    \else
        \newcommand{\wowsol}{\fontfamily{lmss}\selectfont}
    \fi
    \theoremstyle{plain}
    \iftheorembychapter
        \newtheorem{theorem}{Theorem}[chapter]
    \else
        \iftheorembysection
            \newtheorem{theorem}{Theorem}[section]
        \else
            \newtheorem{theorem}{Theorem}
        \fi
    \fi
    \newtheorem{axiom}[theorem]{Axiom}
    \newtheorem{corollary}{Corollary}[theorem]
    \newtheorem*{lemma}{Lemma}
    \newtheorem{numlemma}[theorem]{Lemma}
    \newtheorem{fact}[theorem]{Fact}
    \newtheorem*{remark}{Remark}

    \theoremstyle{definition}
    \newtheorem{definition}[theorem]{Definition}
    \newtheorem*{claim}{Claim}
    \newtheorem*{example}{Example}
    \newtheorem{theoremdef}[theorem]{Theorem}

    \newtheorem{exercise}[theorem]{Exercise}
    \newtheorem{problem}[theorem]{Problem}
    \newtheorem*{challenge}{Challenge}
    \newtheorem{numsol}{\wowsol Solution}
    \newtheorem*{solution}{\wowsol Solution}
    \newtheorem*{warning}{Warning}
    \newtheorem*{alternative}{Alternative}
    \newtheorem{algorithm}{Algorithm}
    \newtheorem*{walkthrough}{Walkthrough}

    \newcommand{\clubs}[1]{\bgroup\color{blue!70!black}[$#1\clubsuit$]\egroup}
    \newcommand{\clubr}[1]{\bgroup\color{red!80!black}[$#1\clubsuit$]\egroup}
    \newcommand{\clubg}[1]{\bgroup\color{green!40!black}[$#1\clubsuit$]\egroup}

    \newtheorem{probE}[problem]{\clubs{2} Problem}
    \newtheorem{probM}[problem]{\clubs{3} Problem}
    \newtheorem{probH}[problem]{\clubs{5} Problem}
    \newtheorem{probZ}[problem]{\clubs{9} Problem}
    \newtheorem{probER}[problem]{\clubr{2} Problem}
    \newtheorem{probMR}[problem]{\clubr{3} Problem}
    \newtheorem{probHR}[problem]{\clubr{5} Problem}
    \newtheorem{probZR}[problem]{\clubr{9} Problem}

    \newcommand{\goals}[2]{\bgroup
		\sffamily\emph{Instructions}: Solve \clubg{#1}.
		If you have time, solve \clubg{#2}.
		Problems with {\color{red} red} weights are mandatory.
		\egroup
    }

    \ifcolorthmon
    %\theoremstyle{plain}
        \declaretheorem[style=thmbluebox,%
            sibling=theorem,%
        name=Theorem]{boxthm}
        \declaretheorem[style=thmbluebox,%
        %sibling=theorem,%
            numbered=no,
        name=Theorem]{boxthm*}
        \declaretheorem[style=thmbluebox,%
            sibling=corollary,%
        name=Corollary]{boxcoro}
        %\declaretheorem[style=thmbluebox,%
        %parent=section,%
        %name=Theorem]{boxsecthm}
        \declaretheorem[style=thminlinebluebox,%
            numbered=no,
        name=\$]{shell}
        \declaretheorem[style=thmbluebox,%
        sibling=theorem,%
        name=Algorithm]{boxalgo}
        \declaretheorem[style=thmbluebox,%
        %sibling=theorem,%
            numbered=no,
        name=Algorithm]{boxalgo*}
        \declaretheorem[style=thmbluebox,%
            parent=section,%
        name=Algorithm]{boxsecalgo}
        %\theoremstyle{definition}
        \ifrollingboxprob
            \declaretheorem[style=thmgreenbox,%
                sibling=theorem,%
            name=Problem]{boxprob}
        \else
            \declaretheorem[style=thmgreenbox,%
            name=Problem]{boxprob}
        \fi
        \declaretheorem[style=thmgreenbox,%
        %sibling=theorem,%
            numbered=no,
        name=Problem]{boxprob*}
        \declaretheorem[style=thmgreenbox,%
            parent=section,%
        name=Problem]{boxsecprob}
        \declaretheorem[style=thmgreenborder,%
        %parent=section,
            sibling=boxthm,
        name=Example]{boxexample}
        \declaretheorem[style=thmlimebox,%
        %sibling=theorem,%
            numbered=no,
        name=Restated Problem]{boxrprob}
        \declaretheorem[style=thmlimeborder,%
            numbered=no,
        name=Solution]{boxsol}
        \declaretheorem[style=thmlimeborder,%
            numbered=no,
        name=Proof]{boxproof}
        \declaretheorem[style=thmlimebox,%
        %sibling=theorem,%
            numbered=no,
        name=Generalization]{boxgprob}
        \declaretheorem[style=thmredbox,%
        %        sibling=theorem,%
        name=Lemma]{boxlemma}
        \declaretheorem[style=thmredbox,%
        %sibling=theorem,%
            numbered=no,
        name=Lemma]{boxlemma*}
        \declaretheorem[style=thmredbox,%
            numbered=no,
        name=Warning]{boxwarn}
        \declaretheorem[style=thmorangebox,%
        %sibling=theorem,%
        name=Claim]{boxclaim}
        \declaretheorem[style=thmorangebox,%
        %sibling=theorem,%
            numbered=no,
        name=Claim]{boxclaim*}
        \declaretheorem[style=thminlineorangebox,%
        name=Claim]{iclaim}
        \declaretheorem[style=thminlineorangebox,%
            numbered=no,
        name=Claim]{iclaim*}
        \declaretheorem[style=thmblackbox,%
        %sibling=theorem,
            numbered=no,
        name=Remark]{boxremark}
        \declaretheorem[style=thmblackbox,%
            numbered=no,
        name=Note]{boxnote}
        \declaretheorem[style=thmpurplebox,
            sibling=theorem,
        name=Definition]{boxdef}
        \declaretheorem[style=thmpurplebox,
        %sibling=theorem,
            numbered=no,
        name=Definition]{boxdef*}

        \declaretheorem[style=thmbluebox,%
        name=Theorem]
        {innercustomboxthm}
        \newenvironment{customboxthm}[1]
        {\renewcommand\theinnercustomboxthm{#1}
        \innercustomboxthm}
        {\endinnercustomboxthm}

        \declaretheorem[style=thmgreenbox,%
        name=Problem]
        {innercustomboxprob}
        \newenvironment{customboxprob}[1]
        {\renewcommand\theinnercustomboxprob{#1}
        \innercustomboxprob}
        {\endinnercustomboxprob}

        \declaretheorem[style=thmlimeborder,%
        name=Solution]
        {innercustomboxsol}
        \newenvironment{customboxsol}[1]
        {\renewcommand\theinnercustomboxsol{#1}
        \innercustomboxsol}
        {\endinnercustomboxsol}

        \declaretheorem[style=thmlimeborder,%
        name=Proof]
        {innercustomboxproof}
        \newenvironment{customboxproof}[1]
        {\renewcommand\theinnercustomboxproof{#1}
        \innercustomboxproof}
        {\endinnercustomboxproof}

        \declaretheorem[style=thmpurplebox,%
        name=Definition]
        {innercustomboxdef}
        \newenvironment{customboxdef}[1]
        {\renewcommand\theinnercustomboxdef{#1}
        \innercustomboxdef}
        {\endinnercustomboxdef}
    \else
    %\theoremstyle{plain}
%        \newmdtheoremenv[outerlinewidth=2,leftmargin=1,%
%            rightmargin=1,%backgroundcolor=blue,%
%            outerlinecolor=blue,innertopmargin=0,%\topskip
%            splittopskip=\topskip,
%            skipbelow=\baselineskip,%
%            skipabove=\baselineskip,
%        ntheorem,]{boxthm}{Theorem}
%        %\theoremstyle{definition}
%        \newmdtheoremenv[outerlinewidth=2,leftmargin=1,%
%            rightmargin=1,%backgroundcolor=blue,%
%            outerlinecolor=blue,innertopmargin=0,%
%            splittopskip=\topskip,skipbelow=\baselineskip,%
%            skipabove=\baselineskip,
%        ntheorem,]{boxprob}{Problem}
%        \newmdtheoremenv[outerlinewidth=2,leftmargin=1,%
%            rightmargin=1,%backgroundcolor=blue,%
%            outerlinecolor=blue,innertopmargin=0,%
%            splittopskip=\topskip,skipbelow=\baselineskip,%
%            skipabove=\baselineskip,
%        ntheorem,]{boxlemma}{Lemma}
%        \newmdtheoremenv[outerlinewidth=2,leftmargin=1,%
%            rightmargin=1,%backgroundcolor=blue,%
%            outerlinecolor=blue,innertopmargin=0,%
%            splittopskip=\topskip,skipbelow=\baselineskip,%
%            skipabove=\baselineskip,
%        ntheorem,]{boxclaim}{Claim}
%        \newmdtheoremenv[outerlinewidth=2,leftmargin=1,%
%            rightmargin=1,%backgroundcolor=blue,%
%            outerlinecolor=blue,innertopmargin=0,%
%            splittopskip=\topskip,skipbelow=\baselineskip,%
%            skipabove=\baselineskip,
%        ntheorem,]{boxdef}{Definition}
%%        \theoremstyle{nonumberplain}
%        \newmdtheoremenv[outerlinewidth=2,leftmargin=1,%
%            rightmargin=1,%backgroundcolor=blue,%
%            outerlinecolor=blue,innertopmargin=0,%
%            splittopskip=\topskip,skipbelow=\baselineskip,%
%            skipabove=\baselineskip,
%        ntheorem,]{boxremark}{Remark}
        \declaretheorem[style=thmbox,%
            sibling=theorem,%
        name=Theorem]{boxthm}
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
            numbered=no,
        name=Theorem]{boxthm*}
        \declaretheorem[style=thmbox,%
            sibling=corollary,%
        name=Corollary]{boxcoro}
        %\declaretheorem[style=thmbluebox,%
        %parent=section,%
        %name=Theorem]{boxsecthm}
        \declaretheorem[style=thmbox,%
            numbered=no,
        name=\$]{shell}
        \declaretheorem[style=thmbox,%
        sibling=theorem,%
        name=Algorithm]{boxalgo}
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
            numbered=no,
        name=Algorithm]{boxalgo*}
        \declaretheorem[style=thmbox,%
            parent=section,%
        name=Algorithm]{boxsecalgo}
        %\theoremstyle{definition}
        \ifrollingboxprob
            \declaretheorem[style=thmbox,%
                sibling=theorem,%
            name=Problem]{boxprob}
        \else
            \declaretheorem[style=thmbox,%
            name=Problem]{boxprob}
        \fi
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
            numbered=no,
        name=Problem]{boxprob*}
        \declaretheorem[style=thmbox,%
            parent=section,%
        name=Problem]{boxsecprob}
        \declaretheorem[style=thmbox,%
        %parent=section,
            sibling=boxthm,
        name=Example]{boxexample}
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
            numbered=no,
        name=Restated Problem]{boxrprob}
        \declaretheorem[style=thmbox,%
            numbered=no,
        name=Solution]{boxsol}
        \declaretheorem[style=thmbox,%
            numbered=no,
        name=Proof]{boxproof}
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
            numbered=no,
        name=Generalization]{boxgprob}
        \declaretheorem[style=thmbox,%
        sibling=theorem,%
        name=Lemma]{boxlemma}
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
            numbered=no,
        name=Lemma]{boxlemma*}
        \declaretheorem[style=thmbox,%
            numbered=no,
        name=Warning]{boxwarn}
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
        name=Claim]{boxclaim}
        \declaretheorem[style=thmbox,%
        %sibling=theorem,%
            numbered=no,
        name=Claim]{boxclaim*}
        \declaretheorem[style=thmbox,%
        name=Claim]{iclaim}
        \declaretheorem[style=thmbox,%
            numbered=no,
        name=Claim]{iclaim*}
        \declaretheorem[style=thmsmallbox,%
        %sibling=theorem,
            numbered=no,
        name=Remark]{boxremark}
        \declaretheorem[style=thmbox,%
            numbered=no,
        name=Note]{boxnote}
        \declaretheorem[style=thmbox,
            sibling=theorem,
        name=Definition]{boxdef}
        \declaretheorem[style=thmbox,
        %sibling=theorem,
            numbered=no,
        name=Definition]{boxdef*}

    \fi

% Black square for proof environment
    \iffillqedsymbol
        \renewcommand\qedsymbol{$\blacksquare$}
    \fi
    \ifendproofnow
        \makeatletter
        \renewenvironment{proof}[1][\proofname]{\par
            \normalfont \topsep6\p@\@plus6\p@\relax
            \trivlist
        \item[\hskip\labelsep
                \itshape
            #1\@addpunct{.}]\ignorespaces
        }{%
            \nolinebreak\qedsymbol\endtrivlist\@endpefalse
        }
        \makeatother
    \fi

% custom numbers
    \newtheorem{innercustomthm}{Theorem}
    \newenvironment{customthm}[1]
    {\renewcommand\theinnercustomthm{#1}\innercustomthm}
    {\endinnercustomthm}

    \newtheorem{innercustomprob}{Problem}
    \newenvironment{customprob}[1]
    {\renewcommand\theinnercustomprob{#1}\innercustomprob}
    {\endinnercustomprob}

    \newtheorem{innercustomsol}{\wowsol Solution}
    \newenvironment{customsol}[1]
    {\renewcommand\theinnercustomsol{\wowsol #1}\innercustomsol}
    {\endinnercustomsol}

    \newtheorem{innercustomenv}{}
    \newenvironment{customenv}[1]
    {\renewcommand\theinnercustomenv{\wowsol #1}\innercustomenv}
    {\endinnercustomenv}

    \newenvironment{subproof}[1][Proof]{%
        \begin{proof}[#1] \renewcommand{\qedsymbol}{$\blacksquare$}}%
    {\end{proof}}
    \newenvironment{parlist}{\begin{inparaenum}[(i)]}{\end{inparaenum}}
    \newenvironment{gobble}{\setbox\z@\vbox\bgroup}{\egroup}

\fi %%%% END OF THEOREMS

% ======== SMALLER UTILS ========
% Asymptote
\ifasyenabled
    \usepackage{asymptote}
    \begin{asydef}
        import olympiad;
    \end{asydef}
\fi

% Code
\ifcodeused
    \usepackage{listings}
    \usepackage{color}

    \definecolor{dkgreen}{rgb}{0,0.6,0}
    \definecolor{gray}{rgb}{0.5,0.5,0.5}
    \definecolor{mauve}{rgb}{0.58,0,0.82}

    \lstset{frame=tb,
        language=Java,
        aboveskip=3mm,
        belowskip=3mm,
        showstringspaces=false,
        columns=flexible,
        basicstyle={\small\ttfamily},
        numbers=left,
        numbersep=5pt,
        numberstyle=\tiny\color{gray},
        keywordstyle=\color{blue},
        commentstyle=\color{dkgreen},
        stringstyle=\color{mauve},
        breaklines=true,
        breakatwhitespace=true,
        tabsize=4,
        frame=single
    }
\fi

% Von
\ifvonenabled
    % \von, \voninclude
    \usepackage{von}

    \makeatletter
    % custom environment von
    \def\vonenv{\@ifstar\@vonenvstar\@vonenv}
    \newcommand{\@vonenv}[3][]{%
        \ifthenelse{\isempty{#1}}%
        {\begin{#3}[#2] \voninclude{#2} \end{#3}}%
        {\begin{#3}[#1] \voninclude{#2} \end{#3}}
    }
    \newcommand{\@vonenvstar}[2]{\begin{#2} \voninclude{#1} \end{#2}}

    % von with boxprob
    \def\vonbox{\@ifstar\@vonboxstar\@vonbox}
    \newcommand{\@vonbox}[2][]{\vonenv[#1]{#2}{boxprob}}
    \newcommand{\@vonboxstar}[1]{\vonenv*{#1}{boxprob}}

    % boxprob open solution
    \newcommand\vonprob[1]{\voninclude[0]{#1}}
    \newcommand\vonsol[1]{\voninclude[1]{#1}}

    % Show everything
    \def\vonall{\@ifstar\@vonallstar\@vonall}
    \newcommand{\@vonall}[2][]{\vonbox[#1]{#2}\vonsol{#2}}
    \newcommand{\@vonallstar}[1]{\vonbox*{#1}\vonsol{#1}}

    % vonall with \newpage
    \def\vonfull{\@ifstar\@vonfullstar\@vonfull}
    \newcommand{\@vonfull}[2][]{\vonall[#1]{#2}\newpage}
    \newcommand{\@vonfullstar}[1]{\vonall*{#1}\newpage}

    % von with blue point-values
    \def\vonE{\@ifstar\@vonEstar\@vonE}
    \newcommand{\@vonE}[2][]{\vonenv[#1]{#2}{probE}}
    \newcommand{\@vonEstar}[1][]{\vonenv*{#1}{probE}}

    \def\vonM{\@ifstar\@vonMstar\@vonM}
    \newcommand{\@vonM}[2][]{\vonenv[#1]{#2}{probM}}
    \newcommand{\@vonMstar}[1][]{\vonenv*{#1}{probM}}

    \def\vonH{\@ifstar\@vonHstar\@vonH}
    \newcommand{\@vonH}[2][]{\vonenv[#1]{#2}{probH}}
    \newcommand{\@vonHstar}[1][]{\vonenv*{#1}{probH}}

    \def\vonZ{\@ifstar\@vonZstar\@vonZ}
    \newcommand{\@vonZ}[2][]{\vonenv[#1]{#2}{probZ}}
    \newcommand{\@vonZstar}[1][]{\vonenv*{#1}{probZ}}

    % von with red point-values
    \def\vonER{\@ifstar\@vonERstar\@vonER}
    \newcommand{\@vonER}[2][]{\vonenv[#1]{#2}{probER}}
    \newcommand{\@vonERstar}[1][]{\vonenv*{#1}{probER}}

    \def\vonMR{\@ifstar\@vonMRstar\@vonMR}
    \newcommand{\@vonMR}[2][]{\vonenv[#1]{#2}{probMR}}
    \newcommand{\@vonMRstar}[1][]{\vonenv*{#1}{probMR}}

    \def\vonHR{\@ifstar\@vonHRstar\@vonHR}
    \newcommand{\@vonHR}[2][]{\vonenv[#1]{#2}{probHR}}
    \newcommand{\@vonHRstar}[1][]{\vonenv*{#1}{probHR}}

    \def\vonZR{\@ifstar\@vonZRstar\@vonZR}
    \newcommand{\@vonZR}[2][]{\vonenv[#1]{#2}{probZR}}
    \newcommand{\@vonZRstar}[1][]{\vonenv*{#1}{probZR}}

    % OTIS
    \usepackage{xparse}
    \def\vonotis{\@ifstar\@vonotisstar\@vonotis}
    \NewDocumentCommand{\@vonotis}{ O{} O{} m }{
        \ifthenelse{\isempty{#1}}{
            \ifthenelse{\isempty{#2}}
            {\subsection{#3}}
            {\subsection{#2}}
        }{
            \ifthenelse{\isempty{#2}}
            {\subsection{\clubs{#1}\ #3}}
            {\subsection{\clubs{#1}\ #2}}
        }
        \vonsol{#3}
    }
    \NewDocumentCommand{\@vonotisstar}{ O{} O{} m }{
        \ifthenelse{\isempty{#1}}{
            \ifthenelse{\isempty{#2}}
            {\subsection{#3}}
            {\subsection{#2}}
        }{
            \ifthenelse{\isempty{#2}}
            {\subsection{\clubr{#1}\ #3}}
            {\subsection{\clubr{#1}\ #2}}
        }
        \vonsol{#3}
    }

    \makeatother
\fi

% Arc
\DeclareFontFamily{OMX}{yhex}{}
\DeclareFontShape{OMX}{yhex}{m}{n}{<->yhcmex10}{}
\DeclareSymbolFont{yhlargesymbols}{OMX}{yhex}{m}{n}
\DeclareMathAccent{\wideparen}{\mathord}{yhlargesymbols}{"F3}

% ======== IT'S ME! ========
% Default Values
\author{Eric Shen}
\date{\vspace{-5ex}}

