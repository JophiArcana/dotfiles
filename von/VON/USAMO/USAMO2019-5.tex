desc: A very mean problem
source: USAMO 2019/5
tags: [2019-10, oly, medium, nt, invariant]

---

Two rational numbers $\tfrac mn$ and $\tfrac nm$ are written on a blackboard, where $m$ and $n$ are relatively prime integers. At any point, Evan may pick two of the numbers $x$ and $y$ written on the board and write either their arithmetic mean $\tfrac{x+y}2$ or their harmonic mean $\tfrac{2xy}{x+y}$ on the board as well. Find all pairs $(m,n)$ such that Evan can write $1$ on the board in finitely many steps.

---

This is possible if and only if $m+n$ is a power of $2$. In what follows, let $r=\tfrac mn$, so we begin with $r$ and $\tfrac1r$ on the board.

\bigskip

\textbf{Proof of sufficiency:} Assume $m+n$ is a power of $2$. It is possible to write $1$ on the board only by taking arithmetic means.
\setcounter{claim}0
\begin{claim}
    If $x$ and $y$ are on the board, then for all nonnegative integers $u$, $v$, $t$ with $u+v=2^t$, it is possible to construct \[\frac u{2^t}\cdot x+\frac v{2^t}\cdot y.\]
\end{claim}
\begin{proof}
    The proof is by induction on $t$, with $t=0$ given. Now suppose the hypothesis holds for $t$; we will show it holds for $t+1$.

    For $u+v=2^{t+1}$, if $0\in\{u,v\}$, then we are already done. Otherwise, note that \[\frac u{2^{t+1}}\cdot x+\frac v{2^{t+1}}\cdot y=\frac12\left[\left(\frac1{2^t}\cdot x+\frac1{2^t}\cdot y\right)+\left(\frac{u-1}{2^t}\cdot x+\frac{v-1}{2^t}\cdot y\right)\right],\]
    which is constructable.
\end{proof}

Finally take $x=r$, $y=\tfrac1r$, $u=n$, $v=m$. We can construct \[\frac n{m+n}\cdot r+\frac m{m+n}\cdot\frac1r=1.\]

\bigskip

\textbf{Proof of necessity:} Suppose $p$ is an odd prime dividing $m+n$. Then both numbers on the board are equivalent to $-1\pmod p$. The main idea is in the following claim:
\begin{claim}
    If $x\equiv y\equiv-1\pmod p$, then both their arithmetic mean and harmonic mean are $-1\pmod p$.
\end{claim}
\begin{proof}
    This is fairly obvious: since $2\not\equiv0\pmod p$ and $x+y\equiv-2\not\equiv0\pmod p$, we can check \[\frac{x+y}2\equiv\frac{-2}2\equiv-1\pmod p\quad\text{and}\quad\frac{2xy}{x+y}\equiv\frac2{\frac1x+\frac1y}\equiv\frac2{-2}\equiv-1\pmod p,\]
    and the claim follows.
\end{proof}

If Evan can write $1$ on the board, then $1\equiv-1\pmod p$, which is absurd.

